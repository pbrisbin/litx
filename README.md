# LitX

Execute a Literate Markdown file.

## Motivation

At $JOB, we occasionally need to perform operations on our infrastructure that
cannot be completed (in whole or in part) by our usual [IaC][] tooling. For such
cases, we will still script the steps and commit that script to our
infrastructure repository by way of Pull Request -- this allows code review,
satisfies the two-person rule, and creates an audit trail.

[iac]: https://en.wikipedia.org/wiki/Infrastructure_as_code

[Literate Programming][literate] is a perfect fit for such scripts, which should
ideally be documented with context, warnings, and other details -- in a
maximally-readable format. A markdown file with the script embedded as
code-blocks throughout works well, but we still want to be able to execute those
code-blocks exactly as written without error-prone copy-pasting into a terminal.

[literate]: https://en.wikipedia.org/wiki/Literate_programming

LitX does exactly that.

## Example

Given [this input][input],

![](./files/example-md.png)

LitX can generate (and execute) [this output][output],

![](./files/example-bash.png)

[input]: ./files/example.md
[output]: ./files/example.bash

## Basic Usage

Build and execute the code-blocks in `op.md`:

```console
litx <./op.md

litx -i - <./op.md

litx -i ./op.md
```

Build the code-blocks in `op.md` into `op.bash`, do not execute it:

```console
litx -o - <./op.md >./op.bash

litx -o ./op.bash <./op.md

litx --exec cat <./.op.md >./op.bash
```

## Complete Usage

```console
% litx --help
Usage: litx [-i|--input PATH|-] [-l|--language bash] [-o|--output PATH|-] 
            [-s|--save PATH|-] [--exec CMD] [--exec-arg ARG] [--exec-no-env] 
            [--shebang TEXT] [--banner TEXT] [--preamble TEXT]
  Execute Literate Markdown programs

Available options:
  -i,--input PATH|-        Read Markdown from PATH (default: -)
  -l,--language bash       Extract and execute code blocks in this language
  -o,--output PATH|-       Output script to PATH instead of execution
  -s,--save PATH|-         Save script to PATH prior to execution
  --exec CMD               Execute script using CMD
  --exec-arg ARG           Pass additional arguments when executing
  --exec-no-env            Don't inherit ENV in the executed process
  --shebang TEXT           Change the shebang
  --banner TEXT            Change the 'Generated by...' banner
  --preamble TEXT          Change the preamble (e.g. 'set -e')
  -h,--help                Show this help text
```

## Roadmap

- [ ] Add `--check` for (e.g.) running ShellCheck on output
- [ ] Add `--{offset,skip}=[-]N` to target specific code blocks by index
- [ ] `<!-- lintx: ignore -->` pragmas

---

[LICENSE](./LICENSE) | [CHANGELOG](./CHANGELOG.md)
